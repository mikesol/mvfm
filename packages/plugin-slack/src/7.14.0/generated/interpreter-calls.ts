// AUTO-GENERATED by scripts/codegen.ts â€” do not edit

import type { Interpreter, TypedNode } from "@mvfm/core";
import { defineInterpreter, eval_ } from "@mvfm/core";
import type { SLACK_NODE_KINDS_CALLS } from "./node-kinds-calls";

type SlackCallsKind = (typeof SLACK_NODE_KINDS_CALLS)[number];

interface SlackCallsBaseNode<K extends SlackCallsKind = SlackCallsKind> extends TypedNode<unknown> {
  kind: K;
  params?: TypedNode<Record<string, unknown>> | null;
  config: { token: string };
}

export interface SlackCallsAddNode extends SlackCallsBaseNode<"slack/calls_add"> {}
export interface SlackCallsEndNode extends SlackCallsBaseNode<"slack/calls_end"> {}
export interface SlackCallsInfoNode extends SlackCallsBaseNode<"slack/calls_info"> {}
export interface SlackCallsUpdateNode extends SlackCallsBaseNode<"slack/calls_update"> {}
export interface SlackCallsParticipantsAddNode
  extends SlackCallsBaseNode<"slack/calls_participants_add"> {}
export interface SlackCallsParticipantsRemoveNode
  extends SlackCallsBaseNode<"slack/calls_participants_remove"> {}

export const NODE_TO_METHOD_CALLS: Record<string, string> = {
  "slack/calls_add": "calls.add",
  "slack/calls_end": "calls.end",
  "slack/calls_info": "calls.info",
  "slack/calls_update": "calls.update",
  "slack/calls_participants_add": "calls.participants.add",
  "slack/calls_participants_remove": "calls.participants.remove",
};

declare module "@mvfm/core" {
  interface NodeTypeMap {
    "slack/calls_add": SlackCallsAddNode;
    "slack/calls_end": SlackCallsEndNode;
    "slack/calls_info": SlackCallsInfoNode;
    "slack/calls_update": SlackCallsUpdateNode;
    "slack/calls_participants_add": SlackCallsParticipantsAddNode;
    "slack/calls_participants_remove": SlackCallsParticipantsRemoveNode;
  }
}

interface SlackClientLike {
  apiCall(method: string, params?: Record<string, unknown>): Promise<unknown>;
}

export function createSlackCallsInterpreter(client: SlackClientLike): Interpreter {
  const handler = async function* (node: SlackCallsBaseNode) {
    const method = NODE_TO_METHOD_CALLS[node.kind];
    if (!method) throw new Error(`Slack interpreter: unknown node kind "${node.kind}"`);
    const params = node.params != null ? yield* eval_(node.params) : undefined;
    return await client.apiCall(method, params);
  };

  return defineInterpreter<SlackCallsKind>()({
    "slack/calls_add": async function* (node: SlackCallsAddNode) {
      return yield* handler(node);
    },
    "slack/calls_end": async function* (node: SlackCallsEndNode) {
      return yield* handler(node);
    },
    "slack/calls_info": async function* (node: SlackCallsInfoNode) {
      return yield* handler(node);
    },
    "slack/calls_update": async function* (node: SlackCallsUpdateNode) {
      return yield* handler(node);
    },
    "slack/calls_participants_add": async function* (node: SlackCallsParticipantsAddNode) {
      return yield* handler(node);
    },
    "slack/calls_participants_remove": async function* (node: SlackCallsParticipantsRemoveNode) {
      return yield* handler(node);
    },
  });
}
