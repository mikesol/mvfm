// AUTO-GENERATED by scripts/codegen.ts â€” do not edit

import type { Interpreter, TypedNode } from "@mvfm/core";
import { defineInterpreter, eval_ } from "@mvfm/core";
import type { SLACK_NODE_KINDS_DND } from "./node-kinds-dnd";

type SlackDndKind = (typeof SLACK_NODE_KINDS_DND)[number];

interface SlackDndBaseNode<K extends SlackDndKind = SlackDndKind> extends TypedNode<unknown> {
  kind: K;
  params?: TypedNode<Record<string, unknown>> | null;
  config: { token: string };
}

export interface SlackDndEndDndNode extends SlackDndBaseNode<"slack/dnd_endDnd"> {}
export interface SlackDndEndSnoozeNode extends SlackDndBaseNode<"slack/dnd_endSnooze"> {}
export interface SlackDndInfoNode extends SlackDndBaseNode<"slack/dnd_info"> {}
export interface SlackDndSetSnoozeNode extends SlackDndBaseNode<"slack/dnd_setSnooze"> {}
export interface SlackDndTeamInfoNode extends SlackDndBaseNode<"slack/dnd_teamInfo"> {}

export const NODE_TO_METHOD_DND: Record<string, string> = {
  "slack/dnd_endDnd": "dnd.endDnd",
  "slack/dnd_endSnooze": "dnd.endSnooze",
  "slack/dnd_info": "dnd.info",
  "slack/dnd_setSnooze": "dnd.setSnooze",
  "slack/dnd_teamInfo": "dnd.teamInfo",
};

declare module "@mvfm/core" {
  interface NodeTypeMap {
    "slack/dnd_endDnd": SlackDndEndDndNode;
    "slack/dnd_endSnooze": SlackDndEndSnoozeNode;
    "slack/dnd_info": SlackDndInfoNode;
    "slack/dnd_setSnooze": SlackDndSetSnoozeNode;
    "slack/dnd_teamInfo": SlackDndTeamInfoNode;
  }
}

interface SlackClientLike {
  apiCall(method: string, params?: Record<string, unknown>): Promise<unknown>;
}

export function createSlackDndInterpreter(client: SlackClientLike): Interpreter {
  const handler = async function* (node: SlackDndBaseNode) {
    const method = NODE_TO_METHOD_DND[node.kind];
    if (!method) throw new Error(`Slack interpreter: unknown node kind "${node.kind}"`);
    const params = node.params != null ? yield* eval_(node.params) : undefined;
    return await client.apiCall(method, params);
  };

  return defineInterpreter<SlackDndKind>()({
    "slack/dnd_endDnd": async function* (node: SlackDndEndDndNode) {
      return yield* handler(node);
    },
    "slack/dnd_endSnooze": async function* (node: SlackDndEndSnoozeNode) {
      return yield* handler(node);
    },
    "slack/dnd_info": async function* (node: SlackDndInfoNode) {
      return yield* handler(node);
    },
    "slack/dnd_setSnooze": async function* (node: SlackDndSetSnoozeNode) {
      return yield* handler(node);
    },
    "slack/dnd_teamInfo": async function* (node: SlackDndTeamInfoNode) {
      return yield* handler(node);
    },
  });
}
