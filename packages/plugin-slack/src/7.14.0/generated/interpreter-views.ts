// AUTO-GENERATED by scripts/codegen.ts â€” do not edit

import type { Interpreter, TypedNode } from "@mvfm/core";
import { defineInterpreter, eval_ } from "@mvfm/core";
import type { SLACK_NODE_KINDS_VIEWS } from "./node-kinds-views";

type SlackViewsKind = (typeof SLACK_NODE_KINDS_VIEWS)[number];

interface SlackViewsBaseNode<K extends SlackViewsKind = SlackViewsKind> extends TypedNode<unknown> {
  kind: K;
  params?: TypedNode<Record<string, unknown>> | null;
  config: { token: string };
}

export interface SlackViewsOpenNode extends SlackViewsBaseNode<"slack/views_open"> {}
export interface SlackViewsPublishNode extends SlackViewsBaseNode<"slack/views_publish"> {}
export interface SlackViewsPushNode extends SlackViewsBaseNode<"slack/views_push"> {}
export interface SlackViewsUpdateNode extends SlackViewsBaseNode<"slack/views_update"> {}

export const NODE_TO_METHOD_VIEWS: Record<string, string> = {
  "slack/views_open": "views.open",
  "slack/views_publish": "views.publish",
  "slack/views_push": "views.push",
  "slack/views_update": "views.update",
};

declare module "@mvfm/core" {
  interface NodeTypeMap {
    "slack/views_open": SlackViewsOpenNode;
    "slack/views_publish": SlackViewsPublishNode;
    "slack/views_push": SlackViewsPushNode;
    "slack/views_update": SlackViewsUpdateNode;
  }
}

interface SlackClientLike {
  apiCall(method: string, params?: Record<string, unknown>): Promise<unknown>;
}

export function createSlackViewsInterpreter(client: SlackClientLike): Interpreter {
  const handler = async function* (node: SlackViewsBaseNode) {
    const method = NODE_TO_METHOD_VIEWS[node.kind];
    if (!method) throw new Error(`Slack interpreter: unknown node kind "${node.kind}"`);
    const params = node.params != null ? yield* eval_(node.params) : undefined;
    return await client.apiCall(method, params);
  };

  return defineInterpreter<SlackViewsKind>()({
    "slack/views_open": async function* (node: SlackViewsOpenNode) {
      return yield* handler(node);
    },
    "slack/views_publish": async function* (node: SlackViewsPublishNode) {
      return yield* handler(node);
    },
    "slack/views_push": async function* (node: SlackViewsPushNode) {
      return yield* handler(node);
    },
    "slack/views_update": async function* (node: SlackViewsUpdateNode) {
      return yield* handler(node);
    },
  });
}
