---
import Base from "../layouts/Base.astro";
import { Code } from "astro:components";
import Playground from "../components/Playground";
import { getAllExamples } from "../examples";
import { isNamespaceIndex } from "../examples/types";
import { MONO_THEME } from "../themes/mono";

export function getStaticPaths() {
  const examples = getAllExamples();
  return Object.entries(examples).map(([kind, example]) => ({
    params: { slug: kind },
    props: { kind, example },
  }));
}

const { kind, example } = Astro.props;
const isIndex = isNamespaceIndex(example);
---

<Base title={`${kind} â€” MVFM`}>
  <div class="pt-4">
    <h1 class="text-2xl font-bold text-base-50 tracking-tight">{kind}</h1>
    {isIndex ? (
      <div class="mt-4 prose-index">
        <div set:html={example.content} />
        {example.staticCode && (
          <div class="playground-wrapper mt-6">
            <div class="border border-base-800">
              <Code code={example.staticCode} lang="typescript" theme={MONO_THEME} />
            </div>
          </div>
        )}
        {example.code && (
          <div class="playground-wrapper mt-6">
            <div class="playground-fallback border border-base-800">
              <Code code={example.code} lang="typescript" theme={MONO_THEME} />
            </div>
            <Playground code={example.code} client:load />
          </div>
        )}
      </div>
    ) : (
      <>
        <p class="mt-2 text-base text-base-500">{example.description}</p>
        <div class="playground-wrapper mt-10">
          <div class="playground-fallback border border-base-800">
            <Code code={example.code} lang="typescript" theme={MONO_THEME} />
          </div>
          <Playground code={example.code} pglite={example.pglite} mockInterpreter={example.mockInterpreter} redis={example.redis} s3={example.s3} client:load />
        </div>
      </>
    )}
  </div>
</Base>

<style is:global>
  /* Hide fallback once the interactive editor mounts */
  .playground-wrapper:has(.playground-ready) .playground-fallback {
    display: none;
  }
  /* Hide the editor until it's ready */
  .playground-editor {
    display: none;
  }
  .playground-wrapper:has(.playground-ready) .playground-editor {
    display: block;
  }
  /* Match fallback and static code styling to the editor */
  .playground-wrapper pre {
    padding: 16px;
    font-size: 0.875rem;
    line-height: 1.625;
    tab-size: 2;
    margin: 0;
  }
  /* Namespace index prose styling */
  .prose-index {
    color: rgb(var(--base-400));
    font-size: 1rem;
    line-height: 1.75;
  }
  .prose-index p {
    margin-bottom: 1rem;
  }
  .prose-index ul {
    list-style: disc;
    padding-left: 1.5rem;
    margin-bottom: 1rem;
  }
  .prose-index code {
    color: rgb(var(--base-300));
    font-size: 0.875rem;
  }
  .prose-index a {
    color: rgb(var(--base-200));
    text-decoration: underline;
    text-underline-offset: 2px;
  }
  .prose-index a:hover {
    color: rgb(var(--base-50));
  }
</style>
